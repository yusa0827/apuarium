# Git Pull とコンフリクト回避ガイド

ローカル作業を始める前に最新の変更を取り込むことで、プッシュ時のコンフリクトを減らせます。このガイドでは `git pull` の推奨手順と、コンフリクトが発生した場合の基本的な対処をまとめています。

## 1. リモート設定を確認する
```
git remote -v
```
`origin` などのリモート URL が表示されない場合は、先に `git remote add origin <URL>` で登録してください。社内リポジトリやローカルの bare リポジトリを利用する場合も同じです。

## 2. 現在のブランチを把握する
```
git status -sb
```
ブランチ名の前に `## work` のような表示が出ます。リモート追跡ブランチが設定されていない場合は、初回プッシュ時に `git push -u origin <branch>` を実行して紐付けておきましょう。

## 3. 最新の変更を取得する
```
git fetch --all
```
これでリモートの最新コミットがローカルにダウンロードされます。続けて現在のブランチに取り込みます。

```
git pull --rebase
```
`--rebase` を付けると、自分のコミットをリモートの最新コミットの上に積み直すため、履歴が直線的になりコンフリクトも発見しやすくなります。マージコミットを残したい場合は `git pull` だけでも構いません。

## 4. コンフリクトが発生した場合
1. `git status` でコンフリクト中のファイルを確認します。
2. エディタでファイルを開き、`<<<<<<<` `=======` `>>>>>>>` で囲まれた差分を手作業で解消します。
3. 修正後は `git add <file>` でステージし、`git rebase --continue` あるいは `git commit` で処理を完了させます。
4. 作業をやり直したくなったら `git rebase --abort` や `git merge --abort` で pull の操作を取消できます。

## 5. プッシュ前の最終確認
```
git status -sb
```
が `clean` になっていることを確かめ、テストやビルドを実行したあとに `git push` します。pull から push までの間隔が長いと再び差分が発生するので、作業が長引く場合はこまめに `git pull --rebase` を挟んでください。

さらに、コミットやマージ後に未解決のコンフリクトマーカーが残っていないかを次のスクリプトで確認すると安心です。

```
python tools/check_conflicts.py
```

`No unresolved merge conflicts detected.` と表示されればそのまま作業を続行できます。もしマーカーが検出された場合は、該当ファイルを開いて手作業で解消してから再度実行してください。

---
この手順を毎回守ることで、リモートに古い履歴をプッシュしてしまうリスクや大量のコンフリクトに悩まされる機会を大幅に減らせます。
